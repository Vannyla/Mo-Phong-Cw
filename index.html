<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Định Giá & Chiến Lược Chứng Quyền</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --bg-light: #f8f9fa;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #ecf0f1;
            margin: 0;
            padding: 20px;
            color: #333;
            font-size: 15px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1.4fr;
            gap: 20px;
        }

        /* CARD STYLES */
        .card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            height: fit-content;
        }

        h2, h3 {
            margin-top: 0;
            color: var(--primary-color);
        }
        
        .header-title {
            text-align: center;
            grid-column: 1 / -1;
            margin-bottom: 20px;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* INPUT SECTIONS */
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border 0.3s;
        }

        input[type="number"]:focus {
            border-color: var(--accent-color);
            outline: none;
            background-color: #fbfdff;
        }

        .small-note {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
            display: block;
        }

        /* TABS */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .tab-btn {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-btn.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        /* SCENARIO CONTENT */
        .scenario-content {
            display: none;
            animation: fadeIn 0.4s;
        }
        .scenario-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .simulation-input {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #b6dbf8;
            margin-bottom: 20px;
        }

        /* RESULT METRICS */
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #666;
        }

        .metric-value {
            font-weight: 700;
            font-size: 16px;
        }

        .big-result {
            font-size: 24px;
            font-weight: 800;
            text-align: right;
        }

        .text-success { color: var(--success-color); }
        .text-danger { color: var(--danger-color); }
        .text-warning { color: var(--warning-color); }

        /* GLOSSARY */
        .glossary {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            background-color: #fafafa;
            border-radius: 4px;
            padding: 15px;
        }
        .glossary h4 {
            margin-bottom: 10px;
            font-size: 14px;
            color: #7f8c8d;
            text-transform: uppercase;
            font-weight: 700;
        }
        .term-item {
            font-size: 13px;
            margin-bottom: 8px;
            line-height: 1.6;
        }
        .term-item b {
            color: var(--primary-color);
        }
        
        /* Hiển thị công thức toán học giả lập */
        .math-formula {
            font-family: 'Courier New', Courier, monospace;
            background: #eee;
            padding: 2px 5px;
            border-radius: 4px;
            font-weight: bold;
            color: #d35400;
        }

        /* FOOTER NOTE */
        .footer-note {
            grid-column: 1 / -1;
            margin-top: 20px;
            padding: 15px;
            background-color: #fff8e1;
            border-left: 5px solid #ffc107;
            border-radius: 4px;
            font-size: 14px;
            color: #856404;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 class="header-title"><i class="fas fa-chart-line"></i> Giả Lập Giao Dịch Chứng Quyền (CW)</h1>

    <div class="card">
        <h3><i class="fas fa-sliders-h"></i> 1. Thông Số Cấu Hình</h3>
        
        <div class="input-group">
            <label>Giá thực hiện (Strike Price):</label>
            <input type="number" id="strikePrice" value="107550" oninput="calculate()">
            <small class="small-note">Mức giá cổ phiếu cần vượt qua (nếu giữ đáo hạn).</small>
        </div>

        <div class="input-group">
            <label>Tỷ lệ chuyển đổi (Conversion Ratio):</label>
            <input type="number" id="ratio" value="8.5359" step="0.0001" oninput="calculate()">
            <small class="small-note">Số CW cần để đổi 1 cổ phiếu cơ sở.</small>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
        <h4>Vị thế của bạn:</h4>
        <div class="input-group">
            <label>Giá mua CW trung bình (VND):</label>
            <input type="number" id="cwBuyPrice" value="790" oninput="calculate()">
        </div>

        <div class="input-group">
            <label>Số lượng CW sở hữu:</label>
            <input type="number" id="quantity" value="9000" oninput="calculate()">
        </div>
        
        <div class="input-group">
            <label>Phí giao dịch công ty chứng khoán (%):</label>
            <input type="number" id="tradingFeeRate" value="0.15" step="0.01" oninput="calculate()">
            <small class="small-note">Thường từ 0.1% - 0.2%.</small>
        </div>
    </div>

    <div class="card">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('trade')">
                <i class="fas fa-exchange-alt"></i> Kịch bản 1: Bán trước đáo hạn
            </button>
            <button class="tab-btn" onclick="switchTab('hold')">
                <i class="fas fa-hourglass-end"></i> Kịch bản 2: Giữ đến đáo hạn
            </button>
        </div>

        <div id="tab-trade" class="scenario-content active">
            <div class="simulation-input">
                <label style="color: var(--accent-color);"><i class="fas fa-search-dollar"></i> Giá thị trường CW hiện tại (VND):</label>
                <input type="number" id="cwMarketPrice" value="1100" placeholder="Nhập giá CW bạn muốn bán..." oninput="calculate()">
                <small class="small-note">Nhập giá bạn dự định chốt lời hoặc cắt lỗ.</small>
            </div>

            <div class="metric-row">
                <span class="metric-label">Tổng vốn bỏ ra (Gốc + Phí mua):</span>
                <span class="metric-value" id="s1_totalCost">0 VND</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Doanh thu bán (Chưa trừ phí/thuế):</span>
                <span class="metric-value" id="s1_revenue">0 VND</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Phí bán & Thuế (0.1%):</span>
                <span class="metric-value text-danger" id="s1_fees">0 VND</span>
            </div>
            <div class="metric-row" style="border-top: 2px solid #eee; margin-top: 10px; padding-top: 15px;">
                <span class="metric-label" style="font-weight: bold; font-size: 18px;">LÃI / LỖ RÒNG:</span>
                <span class="metric-value big-result" id="s1_netProfit">0 VND</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Tỷ suất lợi nhuận (ROI):</span>
                <span class="metric-value" id="s1_roi">0%</span>
            </div>
            
            <div class="glossary">
                <h4><i class="fas fa-book"></i> Diễn giải Kịch bản 1</h4>
                <div class="term-item"><b>Cơ chế:</b> Mua đi bán lại chứng quyền trên sàn giống hệt cổ phiếu. Lời/Lỗ dựa trên chênh lệch giá CW.</div>
                <div class="term-item"><b>Thuế/Phí:</b> Chịu phí giao dịch (mua & bán) trả cho CTCK + Thuế TNCN 0.1% trên giá trị bán (bất kể lãi lỗ).</div>
            </div>
        </div>

        <div id="tab-hold" class="scenario-content">
            <div class="simulation-input" style="background-color: #fcf3cf; border-color: #f9e79f;">
                <label style="color: #d35400;"><i class="fas fa-chart-bar"></i> Giá thanh toán khi đáo hạn:</label>
                <input type="number" id="stockPriceMaturity" value="114300" placeholder="Giá CKCS..." oninput="calculate()">
                <small class="small-note">Nhập giá cổ phiếu cơ sở dự kiến.</small>
            </div>

            <div class="metric-row">
                <span class="metric-label">Điểm Hòa Vốn CW:</span>
                <span class="metric-value text-warning" id="s2_breakEven">0 VND</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Giá trị 1 CW khi đáo hạn:</span>
                <span class="metric-value" id="s2_valuePerCW">0 VND</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Tổng tiền nhận về (Sau thuế 0.1%):</span>
                <span class="metric-value" id="s2_cashReceived">0 VND</span>
            </div>
             <div class="metric-row" style="border-top: 2px solid #eee; margin-top: 10px; padding-top: 15px;">
                <span class="metric-label" style="font-weight: bold; font-size: 18px;">LÃI / LỖ RÒNG:</span>
                <span class="metric-value big-result" id="s2_netProfit">0 VND</span>
            </div>
            <div class="metric-row">
                <span class="metric-label">Tỷ suất lợi nhuận (ROI):</span>
                <span class="metric-value" id="s2_roi">0%</span>
            </div>

            <div class="glossary">
                <h4><i class="fas fa-book"></i> Diễn giải Kịch bản 2</h4>
                <div class="term-item"><b>Giá thực hiện (K):</b> Mốc giá cố định trong hợp đồng mà bạn kỳ vọng cổ phiếu sẽ vượt qua.</div>
                <div class="term-item"><b>Giá thanh toán (S):</b> Trung bình giá đóng cửa 5 phiên cuối của cổ phiếu cơ sở trước ngày đáo hạn.</div>
                <div class="term-item">
                    <b>Cách tính tiền:</b> 
                    <span class="math-formula">[(S - K) : Tỷ lệ] × Số lượng</span>
                </div>
                <div class="term-item">
                    <b>Lưu ý quan trọng:</b> Nếu giá cổ phiếu thấp hơn giá thực hiện (<span class="math-formula">S ≤ K</span>), chứng quyền không có giá trị và bạn <b>mất trắng vốn</b>.
                </div>
            </div>
        </div>
    </div>

    <div class="footer-note">
        <strong><i class="fas fa-exclamation-triangle"></i> Ghi chú cho Nhà đầu tư:</strong>
        <ul style="margin: 5px 0 0 20px;">
            <li>CW là sản phẩm có đòn bẩy cao, biên độ dao động lớn. Lãi nhanh nhưng rủi ro mất trắng cũng cao.</li>
            <li><strong>Kịch bản 1 (Bán trước đáo hạn):</strong> Được ưa chuộng hơn vì tính thanh khoản và chủ động cắt lỗ/chốt lời.</li>
            <li><strong>Kịch bản 2 (Chờ đáo hạn):</strong> Chỉ nên giữ nếu tin chắc giá cổ phiếu cơ sở sẽ tăng mạnh vượt qua Điểm hòa vốn. Rủi ro là nếu giá không vượt qua Giá thực hiện, giá trị tài sản về 0.</li>
        </ul>
    </div>
</div>

<script>
    const formatter = new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND',
        minimumFractionDigits: 0
    });

    function switchTab(tabName) {
        document.querySelectorAll('.scenario-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function calculate() {
        // INPUTS
        const strikePrice = parseFloat(document.getElementById('strikePrice').value) || 0;
        const ratio = parseFloat(document.getElementById('ratio').value) || 1;
        const cwBuyPrice = parseFloat(document.getElementById('cwBuyPrice').value) || 0;
        const quantity = parseFloat(document.getElementById('quantity').value) || 0;
        const feeRatePercent = parseFloat(document.getElementById('tradingFeeRate').value) || 0;
        
        const feeRate = feeRatePercent / 100;
        const taxRate = 0.001; // 0.1%

        // VỐN ĐẦU TƯ GỐC
        const totalBuyVal = cwBuyPrice * quantity;
        const buyFee = totalBuyVal * feeRate;
        const totalCost = totalBuyVal + buyFee;

        // --- SCENARIO 1: TRADING ---
        const cwMarketPrice = parseFloat(document.getElementById('cwMarketPrice').value) || 0;
        const totalSellVal = cwMarketPrice * quantity;
        const sellFee = totalSellVal * feeRate;
        const sellTax = totalSellVal * taxRate;
        const totalDeductionS1 = sellFee + sellTax;
        
        const netReceiveS1 = totalSellVal - totalDeductionS1;
        const profitS1 = netReceiveS1 - totalCost;
        const roiS1 = totalCost > 0 ? (profitS1 / totalCost) * 100 : 0;

        document.getElementById('s1_totalCost').innerText = formatter.format(totalCost);
        document.getElementById('s1_revenue').innerText = formatter.format(totalSellVal);
        document.getElementById('s1_fees').innerText = "-" + formatter.format(totalDeductionS1);
        updateColorAndText('s1_netProfit', profitS1);
        updateColorAndText('s1_roi', roiS1, true);

        // --- SCENARIO 2: HOLD TO MATURITY ---
        const stockPrice = parseFloat(document.getElementById('stockPriceMaturity').value) || 0;
        
        // Break even point calculation
        const breakEvenStockPrice = strikePrice + ((totalCost / (1 - taxRate)) / quantity) * ratio;

        let cwValueMaturity = 0;
        let totalPayoutPreTax = 0;
        
        if (stockPrice > strikePrice) {
            cwValueMaturity = (stockPrice - strikePrice) / ratio;
            totalPayoutPreTax = cwValueMaturity * quantity;
        }

        const taxMaturity = totalPayoutPreTax * taxRate;
        const netReceiveS2 = totalPayoutPreTax - taxMaturity;
        const profitS2 = netReceiveS2 - totalCost;
        const roiS2 = totalCost > 0 ? (profitS2 / totalCost) * 100 : 0;

        document.getElementById('s2_breakEven').innerText = formatter.format(breakEvenStockPrice);
        document.getElementById('s2_valuePerCW').innerText = formatter.format(cwValueMaturity);
        document.getElementById('s2_cashReceived').innerText = formatter.format(netReceiveS2);
        updateColorAndText('s2_netProfit', profitS2);
        updateColorAndText('s2_roi', roiS2, true);
    }

    function updateColorAndText(elementId, value, isPercent = false) {
        const el = document.getElementById(elementId);
        if (isPercent) {
            el.innerText = value.toFixed(2) + "%";
        } else {
            el.innerText = formatter.format(value);
        }
        
        el.classList.remove('text-success', 'text-danger', 'text-warning');
        if (value > 0) el.classList.add('text-success');
        else if (value < 0) el.classList.add('text-danger');
        else el.classList.add('text-warning');
    }

    window.onload = calculate;
</script>

</body>
</html>


